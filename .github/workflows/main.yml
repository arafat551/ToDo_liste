on: push
name: ðŸš€ DÃ©ployer l'application Laravel Ã  chaque push
jobs:
  web-deploy:
    name: ðŸŽ‰ DÃ©ploiement
    runs-on: ubuntu-latest
    steps:
    - name: ðŸšš RÃ©cupÃ©rer le code le plus rÃ©cent
      uses: actions/checkout@v4

    - name: Configurer PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.0'  # Utilisez la version PHP requise par votre projet

    - name: Installer les extensions PHP nÃ©cessaires
      run: sudo apt-get install -y libzip-dev zip unzip && docker-php-ext-install zip

    - name: ðŸ“¦ Installer les dÃ©pendances Composer
      run: composer install --no-dev --prefer-dist --no-progress --no-suggest

    - name: ðŸ”‘ GÃ©nÃ©rer la clÃ© d'application
      run: php artisan key:generate
      env:
        APP_ENV: production
        APP_KEY: ${{ secrets.APP_KEY }}
        APP_DEBUG: false
        APP_URL: ${{ secrets.APP_URL }}

    - name: Utiliser Node.js 16
      uses: actions/setup-node@v2
      with:
        node-version: '16'
      
    - name: Installer les dÃ©pendances npm
      run: npm install

    - name: ðŸ”¨ Compiler les assets
      run: npm run prod

    - name: ðŸ“‚ Synchroniser les fichiers
      uses: SamKirkland/FTP-Deploy-Action@v4.3.5
      with:
        server: ${{ secrets.FTP_SERVER }}
        username: ${{ secrets.ftp_username }}
        password: ${{ secrets.ftp_password}}
        server_dir: htdocs/

    - name: ðŸ“¦ DÃ©ployer la configuration Laravel
      run: |
        php artisan config:cache
        php artisan route:cache
        php artisan view:cache
